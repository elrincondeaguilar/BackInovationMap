# üöÄ BackInovationMap - API REST para Gesti√≥n de Innovaci√≥n

Una API REST robusta desarrollada en .NET 9 para la gesti√≥n de empresas, convocatorias y usuarios en plataformas de innovaci√≥n. **Desplegada en Render y conectada a Supabase PostgreSQL** para m√°ximo rendimiento y escalabilidad.

## üåê URLs de Producci√≥n

- **üöÄ API en Producci√≥n**: https://backinovationmap.onrender.com
- **üìö Documentaci√≥n Swagger**: https://backinovationmap.onrender.com/swagger
- **üìä Estado de la API**: https://backinovationmap.onrender.com/api/companies/health

## ‚≠ê Caracter√≠sticas Principales

- **üè¢ Gesti√≥n de Empresas**: CRUD completo con health checks
- **üì¢ Gesti√≥n de Convocatorias**: Sistema avanzado con estados autom√°ticos y manuales
- **üîê Autenticaci√≥n JWT**: Sistema de autenticaci√≥n seguro con tokens JWT
- **‚òÅÔ∏è Base de Datos en la Nube**: PostgreSQL en Supabase con pooling autom√°tico
- **üìö Documentaci√≥n**: Swagger/OpenAPI integrado en desarrollo y producci√≥n
- **üõ°Ô∏è Seguridad**: Validaci√≥n de datos, logging avanzado y manejo de errores
- **üåê CORS**: Configurado para localhost:3000 y Vercel production
- **üéØ Estados Flexibles**: Control manual y autom√°tico de estados de convocatorias
- **üîç Health Checks**: Endpoints de monitoreo para producci√≥n
- **üìù Logging Avanzado**: Tracking detallado de requests y errores

## üõ†Ô∏è Stack Tecnol√≥gico

- **.NET 9**: Framework principal
- **ASP.NET Core**: API REST
- **Entity Framework Core**: ORM con PostgreSQL
- **Supabase**: Base de datos PostgreSQL en la nube
- **JWT**: Autenticaci√≥n y autorizaci√≥n
- **BCrypt**: Hasheo seguro de contrase√±as
- **Swagger**: Documentaci√≥n autom√°tica de API
- **Npgsql**: Driver PostgreSQL optimizado

## üöÄ Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- .NET 9 SDK
- Cuenta en Supabase (ya configurada)
- Editor de c√≥digo (Visual Studio, VS Code, etc.)

### 1. Clonar el Repositorio

```bash
git clone https://github.com/tu-usuario/BackInovationMap.git
cd BackInovationMap
```

### 2. Configuraci√≥n de Base de Datos Supabase

‚úÖ **La aplicaci√≥n ya est√° configurada y desplegada con conexi√≥n a Supabase:**

**üìä Credenciales de Producci√≥n:**

- üîí \*[Informaci√≥n sensible eliminada]\*\*\*: Ide0qDV5AJeb83wL
- **Pooler**: Habilitado para m√°ximo rendimiento

**üîß Migraciones Aplicadas:**

- ‚úÖ **InitialCreate** - Tablas b√°sicas (Users, Companies, Convocatorias)
- ‚úÖ **AddEstadoManualToConvocatoria** - Control manual de estados

> La configuraci√≥n est√° en `appsettings.json` y las migraciones ya est√°n aplicadas en Supabase

### 3. Instalaci√≥n y Ejecuci√≥n

```bash
# 1. Restaurar dependencias
dotnet restore

# 2. Compilar proyecto
dotnet build

# 3. Aplicar migraciones (ya aplicadas a Supabase)
dotnet ef database update

# 4. Ejecutar la aplicaci√≥n
dotnet run
```

üéâ **La API estar√° disponible en:**

- **Desarrollo**: `http://localhost:5297`
- **Producci√≥n**: `https://backinovationmap.onrender.com`

### 4. Verificar Conexi√≥n

**En desarrollo:**

- Abre tu navegador en: `http://localhost:5297/swagger`

**En producci√≥n:**

- API: `https://backinovationmap.onrender.com/api/convocatorias`
- Swagger: `https://backinovationmap.onrender.com/swagger`
- Health Check: `https://backinovationmap.onrender.com/api/companies/health`

## üèóÔ∏è Arquitectura del Proyecto

```
BackInovationMap/
‚îú‚îÄ‚îÄ Controllers/         # Controladores de API
‚îÇ   ‚îú‚îÄ‚îÄ AuthController.cs      # Autenticaci√≥n y usuarios
‚îÇ   ‚îú‚îÄ‚îÄ CompaniesController.cs # Gesti√≥n de empresas
‚îÇ   ‚îî‚îÄ‚îÄ ConvocatoriasController.cs # Gesti√≥n de convocatorias
‚îú‚îÄ‚îÄ Data/               # Contexto de base de datos
‚îÇ   ‚îî‚îÄ‚îÄ AppDbContext.cs        # Configuraci√≥n EF Core
‚îú‚îÄ‚îÄ DTOs/               # Objetos de transferencia de datos
‚îÇ   ‚îú‚îÄ‚îÄ AuthDto.cs            # DTOs de autenticaci√≥n
‚îÇ   ‚îî‚îÄ‚îÄ ConvocatoriaDto.cs    # DTOs de convocatorias
‚îú‚îÄ‚îÄ Models/             # Modelos de entidad
‚îÇ   ‚îú‚îÄ‚îÄ Company.cs            # Modelo de empresa
‚îÇ   ‚îú‚îÄ‚îÄ Convocatoria.cs       # Modelo de convocatoria
‚îÇ   ‚îî‚îÄ‚îÄ Usuario.cs            # Modelo de usuario
‚îú‚îÄ‚îÄ Services/           # Servicios de negocio
‚îÇ   ‚îî‚îÄ‚îÄ JwtService.cs         # Servicio JWT
‚îú‚îÄ‚îÄ Migrations/         # Migraciones aplicadas a Supabase
‚îî‚îÄ‚îÄ Program.cs          # Configuraci√≥n y startup
```

## üìñ Documentaci√≥n de la API

### üîç Swagger UI

**Documentaci√≥n interactiva disponible en:**

```
http://localhost:5297/swagger
```

### üìã Endpoints Principales

#### ÔøΩ Health Checks

| M√©todo | Endpoint                    | Descripci√≥n                | Status |
| ------ | --------------------------- | -------------------------- | ------ |
| GET    | `/api/companies/health`     | Health check general       | ‚úÖ     |
| GET    | `/api/convocatorias/health` | Health check convocatorias | ‚úÖ     |
| GET    | `/api/companies/debug`      | Debug info empresas        | ‚úÖ     |

#### ÔøΩüîê Autenticaci√≥n (`/api/auth`)

| M√©todo | Endpoint           | Descripci√≥n               | Requiere Auth |
| ------ | ------------------ | ------------------------- | ------------- |
| POST   | `/register`        | Registrar nuevo usuario   | ‚ùå            |
| POST   | `/login`           | Iniciar sesi√≥n            | ‚ùå            |
| GET    | `/profile`         | Obtener perfil de usuario | ‚úÖ            |
| PUT    | `/change-password` | Cambiar contrase√±a        | ‚úÖ            |
| POST   | `/refresh-token`   | Refrescar token JWT       | ‚úÖ            |
| GET    | `/validate`        | Validar token             | ‚úÖ            |

#### üè¢ Empresas (`/api/companies`)

| M√©todo | Endpoint  | Descripci√≥n                | Requiere Auth | Status |
| ------ | --------- | -------------------------- | ------------- | ------ |
| GET    | `/`       | Obtener todas las empresas | ‚ùå            | ‚úÖ     |
| GET    | `/{id}`   | Obtener empresa por ID     | ‚ùå            | ‚úÖ     |
| POST   | `/`       | Crear nueva empresa        | ‚úÖ            | ‚úÖ     |
| PUT    | `/{id}`   | Actualizar empresa         | ‚úÖ            | ‚úÖ     |
| DELETE | `/{id}`   | Eliminar empresa           | ‚úÖ            | ‚úÖ     |
| GET    | `/health` | Health check               | ‚ùå            | ‚úÖ     |
| GET    | `/debug`  | Debug info                 | ‚ùå            | ‚úÖ     |

#### üì¢ Convocatorias (`/api/convocatorias`)

| M√©todo | Endpoint                   | Descripci√≥n                     | Requiere Auth | Status |
| ------ | -------------------------- | ------------------------------- | ------------- | ------ |
| GET    | `/`                        | Obtener todas las convocatorias | ‚ùå            | ‚úÖ     |
| GET    | `/{id}`                    | Obtener convocatoria por ID     | ‚ùå            | ‚úÖ     |
| POST   | `/`                        | **Crear nueva convocatoria**    | ‚ùå            | ‚úÖ     |
| PUT    | `/{id}`                    | Actualizar convocatoria         | ‚úÖ            | ‚úÖ     |
| DELETE | `/{id}`                    | Eliminar convocatoria           | ‚úÖ            | ‚úÖ     |
| GET    | `/categoria/{categoria}`   | Buscar por categor√≠a            | ‚ùå            | ‚úÖ     |
| GET    | `/estado/{estado}`         | Buscar por estado               | ‚ùå            | ‚úÖ     |
| GET    | `/por-empresa/{companyId}` | Convocatorias por empresa       | ‚ùå            | ‚úÖ     |
| PUT    | `/{id}/estado`             | **Cambio manual de estado**     | ‚úÖ            | ‚úÖ     |
| PUT    | `/{id}/estado/automatico`  | **Volver a estado autom√°tico**  | ‚úÖ            | ‚úÖ     |
| GET    | `/empresas-disponibles`    | **Empresas para convocatorias** | ‚ùå            | ‚úÖ     |
| GET    | `/health`                  | **Health check**                | ‚ùå            | ‚úÖ     |

## ÔøΩ Frontend Integration

### üì° **CORS Configurado para:**

- ‚úÖ `http://localhost:3000` (Next.js desarrollo)
- ‚úÖ `http://localhost:3001` (puerto alternativo)
- ‚úÖ `https://localhost:3000` (HTTPS local)
- ‚úÖ `https://innovation-map-frontend.vercel.app` (producci√≥n)

### üöÄ **Crear Convocatoria desde Frontend**

**URL del endpoint:**

```javascript
POST https://backinovationmap.onrender.com/api/convocatorias
```

**Ejemplo de petici√≥n:**

```javascript
const crearConvocatoria = async (datosConvocatoria) => {
  try {
    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL}/api/convocatorias`,
      {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Accept: "application/json",
        },
        body: JSON.stringify({
          Titulo: "Convocatoria de Innovaci√≥n 2025",
          Descripcion: "Programa de apoyo a startups tecnol√≥gicas",
          FechaInicio: "2025-01-15T00:00:00Z",
          FechaFin: "2025-03-15T00:00:00Z",
          Categoria: "tecnolog√≠a",
          Entidad: "Isagen",
          CompanyId: 1,
          Presupuesto: 50000000,
          Requisitos: ["Empresa constituida", "Proyecto innovador"],
        }),
      }
    );

    if (!response.ok) throw new Error(`Error ${response.status}`);
    return await response.json();
  } catch (error) {
    console.error("Error al crear convocatoria:", error);
    throw error;
  }
};
```

**‚ö†Ô∏è Configuraci√≥n Frontend:**

```bash
# Variable de entorno requerida en Vercel:
NEXT_PUBLIC_API_URL=https://backinovationmap.onrender.com
```

### üéØ Caracter√≠sticas Especiales de Convocatorias

#### **Estados Inteligentes**

- **Autom√°tico**: Basado en fechas (pendiente ‚Üí activa ‚Üí cerrada)
- **Manual**: Control total del estado independiente de fechas
- **H√≠brido**: Cambio entre modo manual y autom√°tico

#### **Relaci√≥n con Empresas**

- Cada convocatoria puede estar asociada a una empresa
- Filtrado por empresa convocante
- Informaci√≥n completa de la empresa en las respuestas
- Endpoint espec√≠fico: `/api/convocatorias/empresas-disponibles`

### üîë Autenticaci√≥n JWT

Para acceder a endpoints protegidos (‚úÖ), incluye el token en el header:

```bash
Authorization: Bearer tu_jwt_token_aqui
```

## üí° Ejemplos de Uso

### üß™ **Probar Endpoints en Producci√≥n**

```bash
# 1. Health Check
curl https://backinovationmap.onrender.com/api/companies/health

# 2. Listar empresas disponibles
curl https://backinovationmap.onrender.com/api/convocatorias/empresas-disponibles

# 3. Listar convocatorias
curl https://backinovationmap.onrender.com/api/convocatorias
```

### üìù Registrar Usuario

```bash
curl -X POST "https://backinovationmap.onrender.com/api/auth/register" \
  -H "Content-Type: application/json" \
  -d '{
    "nombre": "Juan",
    "apellido": "P√©rez",
    "email": "juan@ejemplo.com",
    "password": "MiPassword123!",
    "confirmPassword": "MiPassword123!"
  }'
```

### üè¢ Crear Empresa

```bash
curl -X POST "https://backinovationmap.onrender.com/api/companies" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token" \
  -d '{
    "name": "TechCorp",
    "description": "Empresa de tecnolog√≠a e innovaci√≥n",
    "sector": "Tecnolog√≠a",
    "department": "Antioquia",
    "url": "https://techcorp.com",
    "logoUrl": "https://techcorp.com/logo.png"
  }'
```

### üì¢ Crear Convocatoria

```bash
curl -X POST "https://backinovationmap.onrender.com/api/convocatorias" \
  -H "Content-Type: application/json" \
  -d '{
    "Titulo": "Convocatoria de Innovaci√≥n Tecnol√≥gica 2025",
    "Descripcion": "Programa para startups tecnol√≥gicas",
    "FechaInicio": "2025-01-15T00:00:00Z",
    "FechaFin": "2025-03-15T00:00:00Z",
    "Categoria": "tecnolog√≠a",
    "Entidad": "Isagen",
    "CompanyId": 1,
    "Presupuesto": 50000000,
    "Requisitos": ["Empresa constituida", "Proyecto innovador"]
  }'
```

### üîÑ Cambiar Estado Manualmente

```bash
# Cambiar a estado manual
curl -X PUT "https://backinovationmap.onrender.com/api/convocatorias/1/estado" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer tu_token" \
  -d '{ "estado": "cerrada" }'

# Volver a estado autom√°tico
curl -X PUT "https://backinovationmap.onrender.com/api/convocatorias/1/estado/automatico" \
  -H "Authorization: Bearer tu_token"
```

## ‚òÅÔ∏è Base de Datos - Supabase PostgreSQL

### ÔøΩ Configuraci√≥n Actual

‚úÖ **Conectado a Supabase PostgreSQL**

**Detalles de conexi√≥n:**

- **Proveedor**: Supabase (PostgreSQL en la nube)
- **Regi√≥n**: AWS US-East-2
- **Base de datos**: postgres
- **Pooler**: Habilitado para m√°ximo rendimiento

### üìã Migraciones Aplicadas

- ‚úÖ **InitialCreate** - Tablas b√°sicas (Users, Companies, Convocatorias)
- ‚úÖ **AddEstadoManualToConvocatoria** - Control manual de estados

### üóÑÔ∏è Modelo de Datos

#### **Usuario**

- ID, Nombre, Apellido, Email
- Password (hasheado con BCrypt)
- Rol, Organizaci√≥n, Tel√©fono
- Fechas de creaci√≥n y √∫ltimo login

#### **Empresa**

- ID, Nombre, Descripci√≥n, Sector
- URL, Logo, Departamento
- Fecha de creaci√≥n

#### **Convocatoria**

- ID, T√≠tulo, Descripci√≥n
- Fechas de inicio y fin
- Categor√≠a, Entidad, Presupuesto
- **Estado** (activa/cerrada/pendiente)
- **EstadoManual** (control autom√°tico/manual)
- **CompanyId** (empresa convocante)
- Requisitos (array de strings)
- Fechas de creaci√≥n y actualizaci√≥n

### üîß Gesti√≥n de Migraciones

```bash
# Ver migraciones pendientes
dotnet ef migrations list

# Crear nueva migraci√≥n
dotnet ef migrations add NombreMigracion

# Aplicar migraciones
dotnet ef database update

# Rollback a migraci√≥n espec√≠fica
dotnet ef database update NombreMigracionAnterior
```

## üõ°Ô∏è Seguridad y Mejores Pr√°cticas

### üîí Seguridad Implementada

- **‚úÖ Hasheo de Contrase√±as**: BCrypt con salt autom√°tico
- **‚úÖ JWT Seguro**: Tokens con expiraci√≥n y claves robustas
- **‚úÖ Validaci√≥n de Datos**: Validaciones en DTOs y modelos
- **‚úÖ Manejo de Errores**: Responses consistentes y sin informaci√≥n sensible
- **‚úÖ CORS Configurado**: Protecci√≥n contra requests no autorizados
- **‚úÖ Base de Datos Segura**: Conexi√≥n cifrada a Supabase

### üõ†Ô∏è Configuraci√≥n de Seguridad

```json
{
  "JwtSettings": {
    "SecretKey": "[ELIMINADO]",
    "Issuer": "BackInovationMap",
    "Audience": "BackInovationMap",
    "ExpirationHours": "24"
  }
}
```

### üí° Recomendaciones para Producci√≥n

1. **üîê Variables de Entorno**: Nunca hardcodees credenciales
2. **üåê HTTPS**: Siempre usa HTTPS en producci√≥n
3. **‚è±Ô∏è Rate Limiting**: Implementa l√≠mites de requests por IP
4. **üìù Logging**: Configura logs centralizados
5. **üîÑ Backup**: Configura respaldos autom√°ticos en Supabase

### üß™ Testing y Monitoreo

#### üîç **Endpoints de Prueba en Producci√≥n**

```bash
# Verificar estado de la API
curl https://backinovationmap.onrender.com/api/companies/health

# Verificar convocatorias
curl https://backinovationmap.onrender.com/api/convocatorias

# Verificar empresas disponibles para convocatorias
curl https://backinovationmap.onrender.com/api/convocatorias/empresas-disponibles
```

#### üìä **Monitoreo**

- **Swagger UI**: `https://backinovationmap.onrender.com/swagger`
- **Health Check**: Endpoints p√∫blicos responden con datos
- **Logs**: Logging avanzado configurado en producci√≥n
- **Database**: Supabase dashboard para monitoreo de BD

## üöÄ Deployment y Producci√≥n

### ‚òÅÔ∏è **Estado Actual de Producci√≥n**

‚úÖ **API completamente desplegada en Render:**

- **URL de Producci√≥n**: https://backinovationmap.onrender.com
- **Swagger en Producci√≥n**: https://backinovationmap.onrender.com/swagger
- **Health Check**: https://backinovationmap.onrender.com/api/companies/health
- **Base de Datos**: Supabase PostgreSQL conectada y operacional
- **Redespliegue**: Autom√°tico con cada push a GitHub

### üîß **Configuraci√≥n de Render**

El proyecto incluye configuraci√≥n para Render:

```dockerfile
# Dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:9.0 AS base
WORKDIR /app
EXPOSE 80

FROM mcr.microsoft.com/dotnet/sdk:9.0 AS build
WORKDIR /src
COPY ["BackInovationMap.csproj", "."]
RUN dotnet restore "BackInovationMap.csproj"
COPY . .
RUN dotnet build "BackInovationMap.csproj" -c Release -o /app/build

FROM build AS publish
RUN dotnet publish "BackInovationMap.csproj" -c Release -o /app/publish

FROM base AS final
WORKDIR /app
COPY --from=publish /app/publish .
CMD ["dotnet", "BackInovationMap.dll"]
```

**Start Command en Render:**

```bash
dotnet BackInovationMap.dll
```

### üì¶ Desarrollo Local vs Producci√≥n

#### üè† **Desarrollo Local**

```bash
# Ejecutar en modo desarrollo
dotnet run --environment Development

# Con puerto espec√≠fico
dotnet run --urls "http://localhost:5001"

# Swagger local disponible en:
http://localhost:5297/swagger
```

#### ‚òÅÔ∏è **Producci√≥n (Render)**

- **URL**: https://backinovationmap.onrender.com
- **Redespliegue**: Autom√°tico con cada `git push`
- **Variables de entorno**: Configuradas en Render
- **Base de datos**: Supabase PostgreSQL
- **CORS**: Configurado para localhost y Vercel

### üåê **Otras plataformas**

El proyecto est√° listo para desplegar en:

- **Azure App Service**
- **AWS Elastic Beanstalk**
- **Google Cloud Run**
- **Railway**, **Fly.io**

> La base de datos ya est√° en Supabase, solo necesitas desplegar la API.

## üìû Contacto y Soporte

### üë®‚Äçüíª Informaci√≥n del Desarrollador

- **Desarrollador**: Juan [Tu Nombre]
- **Proyecto**: BackInovationMap - API de Gesti√≥n de Innovaci√≥n
- **Universidad**: EAFIT - Especializaci√≥n
- **A√±o**: 2025

### üîó Enlaces √ötiles

- **ÔøΩ API en Producci√≥n**: https://backinovationmap.onrender.com
- **ÔøΩüìñ Documentaci√≥n Swagger**: https://backinovationmap.onrender.com/swagger
- **‚òÅÔ∏è Base de Datos**: [Supabase Dashboard](https://supabase.com/dashboard)
- **üõ†Ô∏è Entity Framework**: [Documentaci√≥n oficial](https://docs.microsoft.com/ef/)
- **üì¶ Repositorio GitHub**: https://github.com/elrincondeaguilar/BackInovationMap

## üéØ Estado del Proyecto

**‚úÖ COMPLETADO Y DESPLEGADO EN PRODUCCI√ìN**

- Backend API completo ‚úÖ
- **Desplegado en Render** ‚úÖ (`https://backinovationmap.onrender.com`)
- Base de datos Supabase conectada ‚úÖ
- Autenticaci√≥n JWT implementada ‚úÖ
- CRUD de empresas y convocatorias ‚úÖ
- Estados manuales/autom√°ticos ‚úÖ
- **Health checks y monitoring** ‚úÖ
- **Logging avanzado** ‚úÖ
- **CORS para localhost y Vercel** ‚úÖ
- Documentaci√≥n completa ‚úÖ
- Listo para integraci√≥n con frontend ‚úÖ

### üìä **Datos de Producci√≥n**

**Empresas disponibles**: 2 (Isagen, MinCiencias)  
**Convocatorias**: 1 (Test Convocatoria)  
**Uptime**: 24/7 en Render  
**Base de datos**: PostgreSQL en Supabase

### üöÄ **Para Frontend Developers**

**URL de la API**: `https://backinovationmap.onrender.com`  
**Documentaci√≥n**: `https://backinovationmap.onrender.com/swagger`  
**Variable de entorno**: `NEXT_PUBLIC_API_URL=https://backinovationmap.onrender.com`

## üôè Agradecimientos

- üë©‚Äçüè´ **Prof. Marinellys Figueroa** ‚Äì Por su orientaci√≥n y acompa√±amiento en este proyecto
- üë®‚Äçüíª **Juan Fernando Aguilar Rinc√≥n** ‚Äì Desarrollador del backend y autor del proyecto
- üè´ **EAFIT** ‚Äì Universidad por la formaci√≥n acad√©mica

---

‚≠ê **¬°No olvides darle una estrella al proyecto si te fue √∫til!** ‚≠ê

#
